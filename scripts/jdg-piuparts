#!/bin/bash
flavour=debian
# use according mirror when building for Ubuntu
case "${distribution}" in
  xenial|trusty|precise|lucid)
    export MIRROR="http://archive.ubuntu.com/ubuntu/"
    export PIUPARTS_COMPONENTS=main,universe,restricted,multiverse
    flavour=ubuntu
    echo "*** Building for Ubuntu release ${distribution}, using mirror $MIRROR and components ${PIUPARTS_COMPONENTS} ***"
    ;;
  lenny|squeeze)
    export MIRROR="http://archive.debian.org/debian/"
    echo "*** Building for Debian release ${distribution}, using mirror $MIRROR ***"
esac

echo "*** architecture ${architecture} ***"

# sadly piuparts always returns with exit code 1 :((
sudo piuparts_wrapper -D ${flavour} -d ${distribution} \
    "${PWD}"/artifacts/*.deb || true

if [ -f piuparts.txt ] ; then
    # generate TAP report
    piuparts_tap piuparts.txt > piuparts.tap
else
	echo "*** No piuparts.txt report ***"
	exit 1
fi
