#!/bin/bash

# use according mirror when building for Ubuntu
case "${distribution}" in
  xenial|trusty|precise|lucid)
    export MIRROR="http://archive.ubuntu.com/ubuntu/"
    export COMPONENTS=main,universe,restricted,multiverse
    echo "*** Building for Ubuntu release ${distribution}, using mirror $MIRROR and components $COMPONENTS ***"
    ;;
  lenny|squeeze)
    export MIRROR="http://archive.debian.org/debian/"
    echo "*** Building for Debian release ${distribution}, using mirror $MIRROR ***"
esac

export architecture=${architecture}
echo "*** architecture ${architecture} ***"

# sadly piuparts always returns with exit code 1 :((
sudo -E piuparts_wrapper "${PWD}"/artifacts/*.deb || true

if [ -f piuparts.txt ] ; then
    # generate TAP report
    piuparts_tap piuparts.txt > piuparts.tap
else
	echo "*** No piuparts.txt report ***"
	exit 1
fi
